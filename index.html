<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üñ•Ô∏è Chat</title>
<style>
  body {
    font-family: "MS Sans Serif", Geneva, sans-serif;
    background: #0077B6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #000;
    margin: 0;
  }

  /* Pulse animation for chat window */
  @keyframes pulse-glow {
    0% { box-shadow: 4px 4px 0 #000, 0 0 10px rgba(255,182,255,0.3); }
    50% { box-shadow: 4px 4px 0 #000, 0 0 25px rgba(255,182,255,0.6); }
    100% { box-shadow: 4px 4px 0 #000, 0 0 10px rgba(255,182,255,0.3); }
  }

  #chat-window {
    width: 380px;
    border: 2px solid #000;
    background: #c0c0c0;
    padding: 0;
    animation: pulse-glow 2s infinite;
  }

  #title-bar {
    background: linear-gradient(90deg, #ff66cc, #66ccff, #ffff99);
    color: #000;
    padding: 5px 10px;
    font-weight: bold;
    text-align: left;
    font-size: 14px;
    user-select: none;
    text-shadow: 0 0 2px #fff;
  }

  #chat-box {
    width: 100%;
    height: 300px;
    background: #ffffff;
    overflow-y: auto;
    border-top: 2px solid #000;
    border-bottom: 2px solid #000;
    padding: 5px;
    box-sizing: border-box;
  }

  .message {
    font-size: 12px;
    padding: 2px 4px;
    margin-bottom: 2px;
    border-left: 2px solid #0000ff;
    background: linear-gradient(90deg, #f0f8ff, #e0e0e0);
    position: relative;
    overflow: hidden;
  }

  .message::after {
    content: '';
    position: absolute;
    top: 0;
    left: -75%;
    width: 50%;
    height: 100%;
    background: linear-gradient(120deg, rgba(255,255,255,0), rgba(255,255,255,0.5), rgba(255,255,255,0));
    transform: skewX(-25deg);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { left: -75%; }
    100% { left: 125%; }
  }

  .user {
    font-weight: bold;
    background: linear-gradient(90deg, #ff66cc, #66ccff, #ffff99);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 2px #fff;
  }

  #input-area {
    display: flex;
    padding: 5px;
    gap: 4px;
    background: #c0c0c0;
    border-top: 2px solid #fff;
    border-left: 2px solid #fff;
    border-bottom: 2px solid #000;
    border-right: 2px solid #000;
  }

  input {
    flex: 1;
    padding: 2px 4px;
    border: 2px solid #000;
    background: #fff;
    font-family: "MS Sans Serif", Geneva, sans-serif;
    font-size: 12px;
  }

  button {
    padding: 2px 6px;
    border: 2px solid #000;
    background: linear-gradient(90deg, #ff66cc, #66ccff, #ffff99);
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    text-shadow: 0 0 2px #fff;
  }

  button:active {
    border-top: 2px solid #000;
    border-left: 2px solid #000;
    border-bottom: 2px solid #fff;
    border-right: 2px solid #fff;
  }
</style>
</head>
<body>

<div id="chat-window">
  <div id="title-bar">Chat</div>
  <div id="chat-box"></div>
  <div id="input-area">
    <input id="name" placeholder="Name">
    <input id="message" placeholder="Message">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, get, child } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCJi_zoww9atKKyXE2f1_Pbt0oq0ZIhJmM",
  authDomain: "deviascope-chat-app.firebaseapp.com",
  projectId: "deviascope-chat-app",
  storageBucket: "deviascope-chat-app.firebasestorage.app",
  messagingSenderId: "940734683100",
  appId: "1:940734683100:web:2dd84c122971c6af7e6119",
  measurementId: "G-4QXTERGCT8"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const messagesRef = ref(db, "messages");
const chatBox = document.getElementById("chat-box");

const OWNER_KEY = "502";

function normalizeName(name) {
  return name.replace(/[^a-z0-9]/gi, '').toLowerCase();
}

function displayMessage(msg) {
  const div = document.createElement("div");
  div.className = "message";
  div.innerHTML = `<span class="user">${msg.name}:</span> ${msg.message}`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Load existing messages
get(child(ref(db), 'messages')).then((snapshot) => {
  if (snapshot.exists()) {
    Object.values(snapshot.val()).forEach(msg => displayMessage(msg));
  }
});

// Real-time updates
onChildAdded(messagesRef, (data) => {
  displayMessage(data.val());
});

window.sendMessage = function() {
  const reservedNames = ["eros", "erostaylor", "honeyvelvet"];
  let name = document.getElementById("name").value.trim() || "Anon";
  const message = document.getElementById("message").value;
  const nameNormalized = normalizeName(name);

  if(reservedNames.includes(nameNormalized)) {
    const key = prompt("Enter owner key to use this name:") || "";
    if (key.trim() !== OWNER_KEY) {
      alert("This name is reserved. You cannot use it.");
      return;
    }
  }

  if(message.trim() !== "") {
    push(messagesRef, { name, message });
    document.getElementById("message").value = "";
  }
};
</script>

</body>
</html>
